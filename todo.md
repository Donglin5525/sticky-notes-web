# Project TODO - 便签应用重构

## 全栈升级
- [x] 启用数据库和用户管理功能 (web-db-user)
- [x] 运行数据库迁移
- [x] 创建便签数据表 (notes table)
- [x] 实现便签 CRUD API (tRPC procedures)
- [x] 实现用户与便签关联

## UI/UX 重新设计
- [x] 设计新的布局结构 (Dashboard 风格)
- [x] 重新设计便签卡片组件 (增加内容展示区域)
- [x] 优化侧边栏导航
- [x] 实现响应式设计
- [x] 添加空状态和加载状态

## 四象限管理功能
- [x] 添加优先级字段 (重要/紧急)
- [x] 创建四象限视图组件
- [ ] 实现拖拽排序功能
- [x] 添加优先级筛选

## PWA 配置
- [x] 配置 Web App Manifest
- [x] 生成应用图标
- [x] 添加 PWA meta 标签
- [ ] 实现 Service Worker (离线支持)
- [ ] 配置安装提示

## 测试与优化
- [x] 编写单元测试
- [ ] 性能优化
- [ ] 最终测试与交付

## UI 修复（用户反馈）
- [x] 修复列表卡片左上角溢出问题
- [x] 修复编辑器底色问题（改为白色底色）
- [x] 优化整体颜色交互设计

## UI 修复（用户反馈 2）
- [x] 修复重要/紧急按钮点击后卡片不实时刷新的问题
- [x] 点击编辑器外部区域时关闭编辑器
- [x] 将列表视图改为条状（横向）展示样式

## 编辑器重构
- [x] 集成 Markdown 编辑器组件
- [x] 支持 Markdown 语法实时预览
- [x] 实现图片粘贴功能
- [x] 图片上传到云端存储（S3）
- [x] 在编辑器中显示已上传的图片

## UI 修复（用户反馈 3）
- [x] Markdown 编辑器默认只显示预览，点击编辑时显示编辑器
- [x] 修复有序列表空行换行时的退出逻辑（MDEditor 组件自带处理）
- [x] 修复颜色筛选组件溢出屏幕问题
- [x] 实现标签层级支持（A/B/C 形式，树状展示）
- [x] 生成新的应用图标供用户选择

## UI 修复（用户反馈 4）
- [x] 修复右侧颜色选择布局溢出问题
- [x] 便签选中交互优化（点击便签/空白处/ESC 取消选中）
- [x] 标签管理功能（编辑、重命名、移动到其他标签下）
- [x] 四象限 TODO 勾选功能（待办事项勾选效果）

## UI 修复（用户反馈 5）
- [x] 修复颜色筛选按钮不够圆的问题（使用 box-shadow 替代 ring）

## Markdown 编辑器重构（WYSIWYG）
- [x] 安装 TipTap 编辑器依赖
- [x] 创建 WYSIWYG 编辑器基础组件
- [x] 实现列表实时渲染（`- ` 转换为圆点）
- [x] 实现智能退格删除（空列表项按 Backspace 清除整行）
- [x] 实现图片内联显示（上传图片直接显示而非 URL）
- [x] 集成到 NoteEditor 组件
- [x] 测试所有功能正常

## 时间显示优化
- [x] 检查数据库时间字段存储格式（使用 Unix 毫秒时间戳）
- [x] 修改前端时间显示为北京时间（UTC+8）
- [x] 测试时间显示正确

## 标签功能增强
- [x] 实现标签选择器弹窗（点击标签图标显示已创建标签列表）
- [x] 实现编辑器内 # 标签提示功能
- [x] 实现标签点击跳转到筛选列表
- [x] 测试所有功能正常


## 标签树优化
- [x] 标签树默认展开所有层级
- [x] 添加树状连接线展示父子层级关系

## 内容标签自动识别
- [x] 分析当前标签处理逻辑
- [x] 实现内容中 #标签 自动提取并添加到便签标签列表
- [x] 测试功能正常

## UI 修复（视图切换按钮）
- [x] 修复列表/四象限按钮选中状态圆角显示不全问题


## 待办清单模块开发
### 原型设计阶段
- [x] 设计顶部 Tab 切换（便签笔记 / 待办清单）
- [x] 设计四象限任务管理界面（优先事项、战略项目、琐碎事务、陷阱区域）
- [x] 设计添加任务功能
- [x] 设计今日总结功能
- [x] 设计智能总结分析功能
- [x] 设计 Prompt 管理弹窗
- [x] 设计历史记录与数据看板（年/月/日维度）

### 原型调整（用户反馈）
- [x] 移除截止时间字段，添加“未完成任务延期提示”功能
- [x] 今日总结改为两栏：今日收获与反思（合并）+ 明日计划（AI 自动分配任务，换行识别，新增按钮）
- [x] 移除“连续打卡”指标

### 开发阶段
#### 数据库设计
- [x] 创建 daily_tasks 表（每日任务）
- [x] 创建 daily_summaries 表（每日总结）
- [x] 创建 prompt_templates 表（Prompt 模板）
- [x] 运行数据库迁移

#### 后端 API
- [x] 实现任务 CRUD API
- [x] 实现今日总结 API
- [x] 实现 Prompt 模板 API
- [x] 实现历史记录查询 API
- [x] 实现未完成任务延期 API

#### 前端页面
- [x] 实现 Tab 切换组件
- [x] 实现四象限任务管理页面
- [x] 实现添加任务弹窗
- [x] 实现今日总结组件
- [x] 实现 Prompt 管理弹窗
- [x] 实现历史记录与数据看板
- [x] 实现未完成任务延期提示弹窗

#### LLM 集成
- [x] 集成大模型 API 实现智能分析
- [x] 实现明日计划 AI 自动分配任务功能

#### 测试
- [x] 编写单元测试
- [x] 测试所有功能

### 性能优化
- [x] 将任务状态更新改为异步批量上报模式
- [x] 实现乐观更新（先更新 UI，后台批量同步）
- [x] 测试验证优化效果

## 待办清单功能增强
### 任务拖拽排序
- [x] 安装拖拽库依赖
- [x] 实现四象限之间的任务拖拽
- [x] 后端支持更新任务象限

### 批量操作
- [x] 添加批量操作按钮和多选模式
- [x] 实现多选任务功能
- [x] 实现批量删除功能
- [x] 实现批量移动到其他象限功能

### 快捷键支持
- [x] 实现快捷键监听
- [x] 添加新建任务快捷键
- [x] 添加切换象限快捷键
- [x] 添加快捷键提示

### 更新日志
- [x] 创建更新日志组件
- [x] 添加更新日志入口按钮
- [x] 记录所有版本更新内容

## UI 修复（用户反馈 - 更新日志）
- [x] 修复更新日志弹窗时间线圆点错位问题

## UI 修复（用户反馈 - 弹窗和拖拽）
- [x] 修复更新日志弹窗内容显示不全问题
- [x] 修复拖拽功能无法在四象限之间切换任务的问题

## 便签笔记功能增强
- [x] 为便签笔记页面添加更新日志入口
- [x] 创建便签笔记独立的更新日志数据

## UI 修复（用户反馈 - 便签笔记内容溢出）
- [x] 修复便签笔记页面用户邮箱超出侧边栏宽度的问题

## 功能修复（用户反馈 - 今日总结）
- [ ] 检查今日总结保存按钮是否存在
- [ ] 确保保存功能正常工作
- [ ] 验证数据能正确存储到数据库

## 功能修复（用户反馈 - 日期切换按钮）
- [x] 修复左箭头按钮点击回退两天的问题 - 修复 addDays 函数时区转换问题
- [x] 修复右箭头按钮点击无效的问题 - 修复 addDays 函数时区转换问题
- [x] 修复键盘左右键日期切换问题 - 更新 useEffect 依赖数组

## UI 调整（用户反馈 - 今日总结布局）
- [x] 将保存总结按钮移到明日计划区域的右下角
- [x] 保持今日收获与反思和明日计划并排布局
## 待办清单功能增强（用户反馈）
### 批量新增任务
- [x] 在四象限区域右下角添加“批量新增”按钮
- [x] 创建批量新增任务弹窗（支持换行输入多个任务）
- [x] 后端实现 AI 自动识别任务分类的 API (batchCreateWithAI)
- [x] 前端调用 API 并批量创建任务

### 四象限副标题
- [x] 优先事项：添加副标题“每天优先、集中精力完成”
- [x] 战略项目：添加副标题“长期、持续、有规划地投入”
- [x] 琐碎事务：添加副标题“批量处理，攒到一起快速搞定”
- [x] 陷阱区域：添加副标题“能拒绝就拒绝，能授权就授权”"


## 任务卡片优化（用户反馈）
- [x] 在任务卡片下方显示备注内容（灰色字体，如有备注则显示）

## 版本管理优化
- [x] 版本号集中管理 - 创建 shared/version.ts 统一管理版本号
- [x] 自动化更新日志 - 在 todo.md 中添加待发布更新区域
- [x] 更新日志通知 - 用户首次访问新版本时自动弹出更新日志

## 待发布更新（下一版本）
<!-- 在这里记录待发布的功能更新，发布时移动到 ChangelogDialog.tsx -->

## 版本管理自动化
- [x] 更新日志数据分离 - 将更新日志数据移到 shared/changelog.json
- [x] 版本号自动递增脚本 - 创建 pnpm version:patch/minor/major 命令

## Git 钩子与发布检查
- [x] Git 提交钩子 - 添加 pre-commit 钩子 (pnpm prepare 安装)
- [x] 版本发布检查清单 - 创建 pnpm release:check 命令

## 应用图标更新
- [x] 更换应用图标为彩色便签扇形设计（橙色渐变背景）
- [x] 生成各种尺寸的 favicon（16x16, 32x32, 180x180）
- [x] 生成 PWA 图标（72x72 到 512x512）
- [x] 更新主题色为橙色（#f97316）

## 习惯打卡功能
### 数据模型与后端
- [x] 创建 Habits 表（id, userId, name, type, sortOrder, isArchived, createdAt）
- [x] 创建 HabitRecords 表（id, habitId, value, note, timestamp）
- [x] 数据库迁移（pnpm db:push）
- [x] 后端 CRUD API（创建/查询/更新/删除/归档习惯）
- [x] 后端打卡记录 API（快捷+1、详细记录、查询记录）
- [x] 后端统计查询 API（按周/月/季度/年聚合）
- [x] 后端拖拽排序 API

### 前端主页视图
- [x] 习惯打卡主页布局（Notion 式极简风）
- [x] 习惯卡片列表（频次类显示 +1 按钮，数值类显示最近值）
- [x] 卡片点击唤起底部弹窗（Bottom Sheet）
- [x] +1 快捷打卡动画反馈
- [x] 新增习惯弹窗（FAB 按钮入口）

### 深度记录表单
- [x] Bottom Sheet 组件（底部滑入弹窗）
- [x] 数值输入框（支持小数点）
- [x] 时间调整器（默认当前时间，支持补录）
- [x] 备注文本框
- [x] 历史最近一次记录参考值

### 归档与删除
- [x] 归档习惯功能
- [x] 归档列表页面
- [x] 从归档恢复习惯
- [x] 彻底删除习惯（含历史记录）

### 统计报表
- [x] 频次类习惯热力图（GitHub 风格）
- [x] 频次类习惯柱状图（按周/月聚合）
- [x] 数值类习惯折线图（趋势变化）
- [x] 时间范围切换（近30天/周/月/季度/年）

### 拖拽排序与路由
- [x] 习惯卡片拖拽排序
- [x] 侧边栏添加习惯打卡入口
- [x] 路由注册（/habits）

### 测试
- [x] 习惯 CRUD 单元测试
- [x] 打卡记录单元测试
- [x] 统计查询单元测试（63 项全部通过）
